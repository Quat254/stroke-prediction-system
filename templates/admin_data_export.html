{% extends "base.html" %}

{% block title %}Data Export - Admin Panel{% endblock %}

{% block content %}
<div class="card">
    <div style="display: flex; justify-content: space-between; align-items: center;">
        <div>
            <h1 style="color: #d4af37; margin-bottom: 10px;">📤 Health Data Export</h1>
            <p style="color: #1e3a5f; font-size: 1.1rem;">Export anonymized health data for research and analysis</p>
        </div>
        <div style="display: flex; gap: 10px;">
            <a href="{{ url_for('admin_dashboard') }}" class="btn btn-secondary">
                ← Back to Dashboard
            </a>
            <a href="{{ url_for('admin_logout') }}" class="btn btn-secondary">
                🚪 Logout
            </a>
        </div>
    </div>
</div>

<div class="grid-2">
    <div class="card">
        <h2>📊 Assessment Data Export</h2>
        <form style="display: flex; flex-direction: column; gap: 15px;">
            <div>
                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Export Format:</label>
                <select style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                    <option value="csv">CSV (Comma Separated Values)</option>
                    <option value="xlsx">Excel Spreadsheet</option>
                    <option value="json">JSON Format</option>
                </select>
            </div>
            
            <div>
                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Date Range:</label>
                <div style="display: flex; gap: 10px;">
                    <input type="date" style="flex: 1; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                    <span style="align-self: center;">to</span>
                    <input type="date" style="flex: 1; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                </div>
            </div>
            
            <div>
                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Data Anonymization:</label>
                <label style="display: block; margin-bottom: 5px;">
                    <input type="checkbox" checked> Remove personal identifiers
                </label>
                <label style="display: block; margin-bottom: 5px;">
                    <input type="checkbox" checked> Hash user IDs
                </label>
                <label style="display: block; margin-bottom: 5px;">
                    <input type="checkbox"> Include demographic data
                </label>
            </div>
            
            <button type="button" class="btn" onclick="exportAssessmentData()">
                📤 Export Assessment Data
            </button>
        </form>
    </div>
    
    <div class="card">
        <h2>👥 User Data Export</h2>
        <form style="display: flex; flex-direction: column; gap: 15px;">
            <div>
                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Export Type:</label>
                <select style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                    <option value="summary">User Summary Report</option>
                    <option value="activity">User Activity Report</option>
                    <option value="demographics">Demographics Only</option>
                </select>
            </div>
            
            <div>
                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Privacy Level:</label>
                <label style="display: block; margin-bottom: 5px;">
                    <input type="radio" name="privacy" value="full" checked> Full Anonymization
                </label>
                <label style="display: block; margin-bottom: 5px;">
                    <input type="radio" name="privacy" value="partial"> Partial Anonymization
                </label>
                <label style="display: block; margin-bottom: 5px;">
                    <input type="radio" name="privacy" value="internal"> Internal Use Only
                </label>
            </div>
            
            <button type="button" class="btn btn-secondary" onclick="exportUserData()">
                📤 Export User Data
            </button>
        </form>
    </div>
</div>

<div class="card">
    <h2>📈 Research Data Packages</h2>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
        <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; border-left: 4px solid #007bff;">
            <h4 style="color: #0056b3; margin-bottom: 15px;">🧬 Stroke Risk Research Package</h4>
            <p style="color: #495057; margin-bottom: 15px;">Anonymized dataset for stroke prediction research including risk factors, demographics, and outcomes.</p>
            <ul style="color: #666; font-size: 14px; margin-bottom: 15px;">
                <li>Age, gender, BMI data</li>
                <li>Medical history indicators</li>
                <li>Risk scores and classifications</li>
                <li>Fully anonymized identifiers</li>
            </ul>
            <button class="btn" onclick="exportResearchPackage('stroke_risk')">
                📦 Generate Package
            </button>
        </div>
        
        <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; border-left: 4px solid #28a745;">
            <h4 style="color: #1e7e34; margin-bottom: 15px;">📊 Population Health Analytics</h4>
            <p style="color: #495057; margin-bottom: 15px;">Aggregated population health data for public health research and policy development.</p>
            <ul style="color: #666; font-size: 14px; margin-bottom: 15px;">
                <li>Population demographics</li>
                <li>Risk factor prevalence</li>
                <li>Geographic distribution</li>
                <li>Trend analysis data</li>
            </ul>
            <button class="btn" style="background: #28a745; color: white;" onclick="exportResearchPackage('population_health')">
                📦 Generate Package
            </button>
        </div>
        
        <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; border-left: 4px solid #ffc107;">
            <h4 style="color: #856404; margin-bottom: 15px;">🔬 Clinical Research Dataset</h4>
            <p style="color: #495057; margin-bottom: 15px;">Comprehensive clinical data for medical research institutions and healthcare providers.</p>
            <ul style="color: #666; font-size: 14px; margin-bottom: 15px;">
                <li>Detailed risk assessments</li>
                <li>Longitudinal user data</li>
                <li>Intervention outcomes</li>
                <li>IRB-compliant formatting</li>
            </ul>
            <button class="btn" style="background: #ffc107; color: #000;" onclick="exportResearchPackage('clinical')">
                📦 Generate Package
            </button>
        </div>
    </div>
</div>

<div class="card">
    <h2>📋 Export History</h2>
    <div style="overflow-x: auto;">
        <table style="width: 100%; border-collapse: collapse;">
            <thead>
                <tr style="background: #f8f9fa;">
                    <th style="padding: 12px; text-align: left; border-bottom: 2px solid #dee2e6;">Export Date</th>
                    <th style="padding: 12px; text-align: left; border-bottom: 2px solid #dee2e6;">Data Type</th>
                    <th style="padding: 12px; text-align: left; border-bottom: 2px solid #dee2e6;">Format</th>
                    <th style="padding: 12px; text-align: left; border-bottom: 2px solid #dee2e6;">Records</th>
                    <th style="padding: 12px; text-align: left; border-bottom: 2px solid #dee2e6;">Status</th>
                    <th style="padding: 12px; text-align: left; border-bottom: 2px solid #dee2e6;">Actions</th>
                </tr>
            </thead>
            <tbody>
                <tr style="border-bottom: 1px solid #dee2e6;">
                    <td style="padding: 12px;">2024-07-28 14:30</td>
                    <td style="padding: 12px;">Assessment Data</td>
                    <td style="padding: 12px;">CSV</td>
                    <td style="padding: 12px;">1,247</td>
                    <td style="padding: 12px;">
                        <span style="background: #28a745; color: white; padding: 4px 8px; border-radius: 12px; font-size: 12px;">
                            ✅ Completed
                        </span>
                    </td>
                    <td style="padding: 12px;">
                        <button class="btn btn-secondary" style="padding: 6px 12px; font-size: 12px;" onclick="downloadExport('export_001')">
                            📥 Download
                        </button>
                    </td>
                </tr>
                <tr style="border-bottom: 1px solid #dee2e6;">
                    <td style="padding: 12px;">2024-07-25 09:15</td>
                    <td style="padding: 12px;">Research Package</td>
                    <td style="padding: 12px;">JSON</td>
                    <td style="padding: 12px;">892</td>
                    <td style="padding: 12px;">
                        <span style="background: #28a745; color: white; padding: 4px 8px; border-radius: 12px; font-size: 12px;">
                            ✅ Completed
                        </span>
                    </td>
                    <td style="padding: 12px;">
                        <button class="btn btn-secondary" style="padding: 6px 12px; font-size: 12px;" onclick="downloadExport('export_002')">
                            📥 Download
                        </button>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
</div>

<script>
function exportAssessmentData() {
    if (confirm('Export assessment data with current settings?')) {
        alert('Assessment data export would be initiated.\n\nThis would:\n- Query assessment database\n- Apply anonymization filters\n- Generate export file\n- Provide download link\n- Log export activity');
    }
}

function exportUserData() {
    if (confirm('Export user data with selected privacy level?')) {
        alert('User data export would be initiated.\n\nThis would:\n- Apply privacy filters\n- Remove/hash personal identifiers\n- Generate anonymized dataset\n- Ensure GDPR/HIPAA compliance');
    }
}

function exportResearchPackage(packageType) {
    if (confirm(`Generate ${packageType} research package?`)) {
        alert(`${packageType} research package would be generated.\n\nThis would:\n- Compile relevant datasets\n- Apply research-grade anonymization\n- Include data dictionary\n- Generate ethics compliance report\n- Package for institutional use`);
    }
}

function downloadExport(exportId) {
    alert(`Download export ${exportId}.\n\nThis would:\n- Verify admin permissions\n- Generate secure download link\n- Log download activity\n- Provide file with timestamp`);
}
</script>
{% endblock %}
